<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100-Week Mastery Plan | Club of Competition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #f8fafc; 
            --card: #ffffff; 
            --text: #020617; 
            --text-muted: #475569; 
            --border: #e2e8f0; 
            --accent: #3b82f6;
        }
        .theme-sepia { 
            --bg: #fdf6e3; 
            --card: #fefcf5; 
            --text: #433422; 
            --text-muted: #6b5a45; 
            --border: #eee8d5; 
            --accent: #b58900;
        }
        .theme-midnight { 
            --bg: #020617; 
            --card: #0f172a; 
            --text: #f8fafc; 
            --text-muted: #94a3b8; 
            --border: #334155; 
            --accent: #3b82f6;
        }

        body { font-family: 'Manrope', sans-serif; background-color: var(--bg); color: var(--text); transition: all 0.3s ease; font-size: 14px; }
        h1, h2, h3, h4 { font-family: 'Poppins', sans-serif; }
        
        .glass-card { background: var(--card); border: 1px solid var(--border); box-shadow: 0 4px 12px -2px rgba(0,0,0,0.05); }
        .exam-chip { background: #f1f5f9; border: 1px solid #e2e8f0; color: #020617; font-weight: 800; border-radius: 8px; }
        
        #progressBar { transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .task-checkbox {
            appearance: none; -webkit-appearance: none;
            height: 1.4rem; width: 1.4rem;
            background-color: transparent; border: 2.5px solid #475569;
            border-radius: 7px; cursor: pointer; transition: all 0.2s;
            position: relative;
        }
        .task-checkbox:checked { background-color: #2563eb; border-color: #2563eb; }
        .task-checkbox:checked::after { content: "✓"; color: white; font-size: 0.85rem; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 900; }
        
        .star-toggle { cursor: pointer; transition: all 0.2s; color: #cbd5e1; }
        .star-toggle.active { color: #f59e0b; fill: #f59e0b; }

        .modal-overlay { background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(8px); opacity: 0; pointer-events: none; transition: 0.3s; z-index: 100; }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }

        .heatmap-square { width: 12px; height: 12px; border-radius: 3px; background: #e2e8f0; position: relative; }
        .heatmap-square.active-1 { background: #bfdbfe; }
        .heatmap-square.active-2 { background: #60a5fa; }
        .heatmap-square.active-3 { background: #2563eb; }

        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, opacity 0.3s ease; opacity: 0; }
        .accordion-content.open { max-height: 25000px; opacity: 1; }
        .chevron-icon { transition: transform 0.3s ease; }
        .chevron-icon.rotated { transform: rotate(180deg); }

        .phase-btn { border-left-width: 6px; background-color: white !important; transition: all 0.3s; }
        .phase-btn:hover { background-color: #f8fafc !important; }
        .phase-blue { border-left-color: #2563eb; color: #1e40af; }
        .phase-green { border-left-color: #10b981; color: #065f46; }
        .phase-purple { border-left-color: #8b5cf6; color: #5b21b6; }
        .phase-red { border-left-color: #ef4444; color: #991b1b; }

        .date-label { font-size: 10px; font-weight: 800; color: #3b82f6; background: #eff6ff; padding: 2px 6px; border-radius: 4px; display: none; }
        .task-checkbox:checked ~ .date-label { display: inline-block; }

        .current-week-pulse { border: 2px solid #3b82f6; animation: pulse-border 2s infinite; }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 8px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="theme-default">

    <!-- Navigator Popup -->
    <div id="navigatorModal" class="fixed inset-0 modal-overlay flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-4xl rounded-[2rem] p-8 relative overflow-hidden flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center mb-6 border-b border-slate-100 pb-4">
                <div>
                    <h2 class="text-xl font-black text-slate-900 uppercase">100-Week Navigator</h2>
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Jump to specific week</p>
                </div>
                <button onclick="closeNavigator()" class="text-slate-400 hover:text-slate-900 transition-colors">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="navigatorGrid" class="grid grid-cols-5 sm:grid-cols-10 gap-2 overflow-y-auto pr-2 pb-4"></div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="focusModal" class="fixed inset-0 modal-overlay flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-lg rounded-[2.5rem] p-8 relative overflow-hidden">
            <button onclick="closeFocus()" class="absolute top-6 right-6 text-slate-400 hover:text-slate-900 transition-colors">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <div class="mb-6">
                <span id="focusPhase" class="text-[10px] font-black uppercase tracking-widest text-blue-600">SYLLABUS DETAIL</span>
                <h2 id="focusTitle" class="text-xl font-black mt-1 leading-tight text-slate-900">Topic</h2>
            </div>
            <div class="bg-slate-50 p-6 rounded-2xl mb-6 border border-slate-100">
                <textarea id="focusNote" class="w-full h-44 bg-white rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-100 p-4 text-sm font-bold text-slate-900 shadow-inner outline-none" placeholder="Add your learning notes here..."></textarea>
            </div>
            <div class="flex gap-3">
                <span id="focusID" class="hidden"></span>
                <button onclick="closeFocus()" class="flex-1 bg-slate-100 text-slate-950 py-3 rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-slate-200">Save & Close</button>
                <button onclick="markDoneInFocus()" class="flex-1 bg-blue-600 text-white py-3 rounded-2xl text-xs font-black uppercase tracking-widest shadow-lg hover:bg-blue-700">Mark as Done</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 pt-10 pb-16 px-4 no-print relative overflow-hidden text-center">
        <div class="container mx-auto max-w-6xl relative z-10">
            <div class="flex justify-center gap-3 mb-8">
                <button onclick="setTheme('default')" class="w-7 h-7 rounded-full bg-blue-100 border-2 border-blue-200 shadow-sm hover:scale-110 transition-all"></button>
                <button onclick="setTheme('sepia')" class="w-7 h-7 rounded-full bg-amber-100 border-2 border-amber-200 shadow-sm hover:scale-110 transition-all"></button>
                <button onclick="setTheme('midnight')" class="w-7 h-7 rounded-full bg-slate-800 border-2 border-slate-900 shadow-sm hover:scale-110 transition-all"></button>
            </div>
            <h1 class="text-4xl md:text-5xl font-black text-slate-950 mb-3 tracking-tight">100-WEEK <span class="text-blue-600 uppercase">Mastery</span></h1>
            <p class="text-slate-600 max-w-xl mx-auto text-sm font-black opacity-90 uppercase tracking-widest">
                Curriculum Tracker • Club of Competition
            </p>

            <div class="mt-8 flex flex-wrap justify-center gap-2 max-w-4xl mx-auto">
                <span class="exam-chip px-3 py-1.5 text-[10px] uppercase tracking-wider">SSC CGL/CHSL</span>
                <span class="exam-chip px-3 py-1.5 text-[10px] uppercase tracking-wider">IBPS PO/Clerk</span>
                <span class="exam-chip px-3 py-1.5 text-[10px] uppercase tracking-wider">SBI PO/Clerk</span>
                <span class="exam-chip px-3 py-1.5 text-[10px] uppercase tracking-wider">RRB NTPC</span>
                <span class="exam-chip px-3 py-1.5 text-[10px] uppercase tracking-wider border-slate-200">RBI/LIC</span>
                <span class="exam-chip px-3 py-1.5 text-[10px] uppercase tracking-wider border-slate-200 text-blue-700">UPSC (F)</span>
                <span class="exam-chip px-3 py-1.5 text-[10px] uppercase tracking-wider border-slate-200 text-red-600">State PSCs</span>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 -mt-10 max-w-7xl pb-20 relative z-20">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <aside class="lg:col-span-3 space-y-6 no-print">
                <div class="sticky top-6 space-y-6">
                    
                    <!-- Progress Card -->
                    <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-200">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-4xl font-black text-slate-950 tracking-tighter" id="percentText">0%</h3>
                                <p class="text-[10px] font-black uppercase tracking-widest text-blue-600 mt-1">Timeline Mastery</p>
                            </div>
                            <div class="bg-blue-50 p-3 rounded-2xl text-center border border-blue-100">
                                <p id="streakVal" class="text-xl font-black text-blue-700">0</p>
                                <p class="text-[8px] font-black uppercase text-blue-400">Streak</p>
                            </div>
                        </div>
                        <div class="space-y-2 mb-6">
                            <div class="flex justify-between text-[10px] font-black uppercase text-slate-400">
                                <span>Level <span id="masteryLevel">1</span></span>
                                <span id="xpText" class="text-blue-600">0 XP</span>
                            </div>
                            <div class="w-full bg-slate-100 rounded-full h-1.5 overflow-hidden">
                                <div id="xpBar" class="bg-blue-500 h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
                            </div>
                        </div>
                        <div id="heatmap" class="flex flex-wrap justify-center gap-1 pt-4 border-t border-slate-50"></div>
                    </div>

                    <!-- Today's Target -->
                    <div id="smartTargetCard" class="bg-white p-6 rounded-[2rem] shadow-md border-2 border-blue-100">
                        <span id="targetTypeLabel" class="text-[10px] font-black uppercase tracking-widest text-blue-600 mb-2 block">TODAY'S MISSION</span>
                        <h4 id="nextTopicTitle" class="text-base font-black leading-tight mb-1 text-slate-900">Set start date...</h4>
                        <p id="nextTopicMeta" class="text-[10px] font-black text-slate-400 uppercase">Phase Tracking</p>
                    </div>

                    <!-- Date Selection -->
                    <div class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm">
                        <div class="mb-4">
                            <label class="text-[10px] font-black text-slate-700 uppercase mb-1 block tracking-wider">Plan Start Date</label>
                            <input type="date" id="planStartDate" onchange="setStartDate(this.value)" class="w-full bg-slate-50 border-2 border-slate-100 rounded-lg p-2 text-xs font-black focus:ring-2 focus:ring-blue-100 text-slate-950 outline-none">
                        </div>
                        <div class="space-y-3" id="sidebarStats"></div>
                        <div class="mt-6 pt-4 border-t border-slate-100 space-y-2">
                            <div class="flex justify-between items-center text-xs">
                                <span class="text-slate-400 font-bold uppercase tracking-tighter">Plan Week</span>
                                <span id="currentPlanWeek" class="font-black text-slate-900 uppercase tracking-tighter">W 1</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="exportProgress()" class="bg-white p-3 rounded-xl border border-slate-200 text-slate-500 hover:text-blue-600 transition-all text-center">
                            <span class="text-[9px] font-black uppercase tracking-widest">Backup</span>
                        </button>
                        <button onclick="confirmReset()" class="bg-white p-3 rounded-xl border border-slate-200 text-slate-400 hover:text-red-600 transition-all text-center">
                            <span class="text-[9px] font-black uppercase tracking-widest">Reset</span>
                        </button>
                    </div>
                </div>
            </aside>

            <div class="lg:col-span-9 space-y-6">
                <!-- Toolbar -->
                <div class="bg-white p-4 rounded-3xl border border-slate-200 flex flex-col md:flex-row items-center gap-4 px-6 no-print sticky top-6 z-30 shadow-sm">
                    <button onclick="openNavigator()" class="flex items-center gap-2 bg-slate-100 text-slate-950 px-4 py-2 rounded-xl text-xs font-black hover:bg-slate-200 transition-all border border-slate-200">
                        <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                        Week Jump
                    </button>

                    <div class="flex items-center flex-1 w-full md:border-r border-slate-100 pr-4">
                        <svg class="w-4 h-4 text-slate-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        <input type="text" id="topicSearch" placeholder="Filter timeline topics..." 
                            class="w-full bg-transparent border-none focus:ring-0 text-sm font-extrabold text-slate-950 py-1">
                    </div>

                    <button onclick="filterMode('starred')" id="starFilterBtn" class="px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest bg-white text-slate-600 hover:bg-amber-400 hover:text-white transition-all shadow-inner border border-slate-200">
                        Revision
                    </button>
                </div>

                <div id="plan-mount" class="space-y-8"></div>
            </div>
        </div>
    </main>

    <!-- Benefits Section Underneath -->
    <section class="bg-slate-50 border-t border-slate-200 py-20 no-print">
        <div class="container mx-auto px-4 max-w-6xl">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-black text-slate-900 mb-4">Why This Plan Works</h2>
                <div class="w-20 h-1.5 bg-blue-600 mx-auto rounded-full"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 hover:border-blue-200 transition-colors">
                    <div class="w-10 h-10 bg-blue-50 text-blue-600 flex items-center justify-center rounded-xl mb-6 font-black">1</div>
                    <h3 class="text-base font-black text-slate-950 mb-3 uppercase tracking-tight">Zero-Burnout Pace</h3>
                    <p class="text-slate-600 font-bold leading-relaxed">Tackling exactly <span class="text-blue-600">one topic per day</span> eliminates the fatigue that leads to quitting. 100 weeks is a marathon, not a sprint.</p>
                </div>
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 hover:border-green-200 transition-colors">
                    <div class="w-10 h-10 bg-green-50 text-green-600 flex items-center justify-center rounded-xl mb-6 font-black">2</div>
                    <h3 class="text-base font-black text-slate-950 mb-3 uppercase tracking-tight">Static Core Mastery</h3>
                    <p class="text-slate-600 font-bold leading-relaxed">Covers the 70% of exam syllabus that <strong>never changes</strong>. Once mastered, you only need to focus on current affairs.</p>
                </div>
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 hover:border-purple-200 transition-colors">
                    <div class="w-10 h-10 bg-purple-50 text-purple-600 flex items-center justify-center rounded-xl mb-6 font-black">3</div>
                    <h3 class="text-base font-black text-slate-950 mb-3 uppercase tracking-tight">Cross-Exam Synergy</h3>
                    <p class="text-slate-600 font-bold leading-relaxed">One roadmap for <span class="text-purple-600">SSC, IBPS, Railways, and PSCs</span>. Master a concept once, and it stays relevant forever.</p>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-white border-t border-slate-200 py-10 no-print">
        <div class="container mx-auto px-4 text-center">
            <p class="text-slate-400 font-black uppercase tracking-[0.3em] text-[10px]">Club of Competition • Success through Discipline</p>
        </div>
    </footer>

    <script>
        // FULL SYLLABUS DATA (ALL 100 WEEKS)
        const planData = [
            { id: "phase-1", title: "Quantitative Aptitude", color: "blue", range: "Weeks 1-35", sections: [
                { name: "Basic Mathematics (Weeks 1-12)", weeks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12] },
                { name: "Advanced Mathematics (Weeks 13-25)", weeks: [13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25] },
                { name: "Quantitative Applications (Weeks 26-35)", weeks: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35] }
            ]},
            { id: "phase-2", title: "Reasoning & Logic", color: "green", range: "Weeks 36-60", sections: [
                { name: "Verbal Reasoning (Weeks 36-45)", weeks: [36, 37, 38, 39, 40, 41, 42, 43, 44, 45] },
                { name: "Puzzles & Arrangements (Weeks 46-60)", weeks: [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60] }
            ]},
            { id: "phase-3", title: "English Language", color: "purple", range: "Weeks 61-73", sections: [
                { name: "Grammar & Vocabulary (Weeks 61-73)", weeks: [61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73] }
            ]},
            { id: "phase-4", title: "General Awareness", color: "red", range: "Weeks 74-100", sections: [
                { name: "GA & History (Weeks 74-100)", weeks: [74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100] }
            ]}
        ];

        const topicsDb = {
            1: ["Types of Numbers", "Divisibility Rules", "HCF & LCM", "Unit Digit & Cyclicity", "Number Properties"],
            2: ["Fraction Operations", "Decimal Operations", "Recurring Decimals", "Surds & Indices", "Simplification"],
            3: ["Percentage Calculation", "Percentage Change", "Population Growth", "Depreciation", "Successive Percentage"],
            4: ["Ratio Basics", "Partnership", "Mean Proportional", "Mixture Problems", "Advanced Ratio"],
            5: ["Simple Average", "Weighted Average", "Average Speed", "Alligation Rule", "Mixture Problems"],
            6: ["Cost Price, Selling Price", "Profit/Loss Percentage", "Discount & MP", "Successive Discount", "Faulty Weights"],
            7: ["SI Formula", "Finding Rate/Time/Principal", "Equal Interest Problems", "Installments in SI", "Multiple Loan Schemes"],
            8: ["Annual Compounding", "Half-yearly Compounding", "Difference SI & CI", "Finding Rate in CI", "Finding Time in CI"],
            9: ["Basic Work Formula", "Work Efficiency", "Wages Distribution", "Alternate Day Work", "Work with Leaving/Joining"],
            10: ["Inlet Pipes", "Outlet Pipes", "Leakage Problems", "Alternate Opening", "Multiple Pipe Systems"],
            11: ["Basic TSD Formula", "Average Speed", "Relative Speed Same Direction", "Relative Speed Opposite Direction", "Train Problems (Pole/Man)"],
            12: ["Train Problems (Platform)", "Trains Crossing Each Other", "Boat & Stream Downstream", "Boat & Stream Upstream", "Speed of Boat/Stream Finding"],
            13: ["Algebraic Identities", "Linear Equations One Variable", "Linear Equations Two Variables", "Quadratic Equations Factorization", "Quadratic Equations Formula"],
            14: ["Sum & Product of Roots", "Nature of Roots", "Sequence & Series Basics", "Arithmetic Progression", "Geometric Progression"],
            15: ["Lines & Angles", "Triangle Types & Properties", "Triangle Congruence", "Triangle Similarity", "Pythagoras Theorem"],
            16: ["Triangle Centers", "Quadrilateral Properties", "Circle Theorems Chord", "Circle Theorems Tangent", "Cyclic Quadrilaterals"],
            17: ["Distance Formula", "Section Formula", "Slope of Line", "Area of Triangle Coordinates", "Straight Line Equations"],
            18: ["Square Area & Perimeter", "Rectangle Area & Perimeter", "Triangle Area & Perimeter", "Circle Area & Circumference", "Complex 2D Shapes"],
            19: ["Cube Volume & Surface Area", "Cuboid Volume & Surface Area", "Cylinder Volume & Surface Area", "Cone Volume & Surface Area", "Sphere Volume & Surface Area"],
            20: ["Trigonometric Ratios", "Trigonometric Identities", "Complementary Angles", "Specific Angle Values", "Height & Distance"],
            21: ["Permutation Basics", "Combination Basics", "Probability Dice", "Probability Coins", "Probability Cards"],
            22: ["Probability Balls in Bag", "Conditional Probability", "Set Theory Basics", "Statistics Mean, Median, Mode", "Range & Frequency"],
            23: ["Table DI Simple", "Table DI Percentage", "Pie Chart Single", "Pie Chart Multiple", "Bar Graph Vertical"],
            24: ["Bar Graph Horizontal", "Bar Graph Stacked", "Line Graph Single", "Line Graph Multiple", "Mixed Graphs"],
            25: ["Caselets", "Data Sufficiency", "Radar DI", "Advanced Table DI", "Complex Pie Charts"],
            26: ["Number Series Advanced", "Mathematical Operations", "Calendar Calculations", "Clock Problems", "Mathematical Puzzles"],
            27: ["SI Applications", "CI Applications", "Profit/Loss in Business", "Percentage in Finance", "Growth Rate Calculations"],
            28: ["Age Problems Advanced", "Number Problems Advanced", "Business Mathematics", "Stock & Shares", "Measurement Systems"],
            29: ["Real-world Applications", "Advanced Calculations", "Approximation Techniques", "Quick Maths Methods", "Problem Solving Strategies"],
            30: ["Basic QC", "Variable QC", "Algebraic QC", "Geometric QC", "DI based QC"],
            31: ["Mean Applications", "Median Applications", "Mode Applications", "Standard Deviation", "Data Analysis Techniques"],
            32: ["Equations with Modulus", "Algebraic Inequalities", "Maximum/Minimum Values", "Functions Basics", "Advanced Sequences"],
            33: ["Similar Triangle Applications", "Advanced Circle Theorems", "3D Geometry Basics", "Coordinate Geometry Advanced", "Complex Shape Analysis"],
            34: ["Permutation Restrictions", "Combination Groups", "Probability Combined Events", "Set Theory Applications", "Advanced Statistics"],
            35: ["Complex Word Problems", "Multi-concept Problems", "Time-bound Solving", "Accuracy Techniques", "Advanced Problem Solving"],
            36: ["Alphabet Series Single", "Alphabet Series Double", "Number Series Addition/Subtraction", "Number Series Multiplication/Division", "Number Series Square/Cube"],
            37: ["Number Series Prime/Composite", "Mixed Series Patterns", "Alphanumeric Series", "Symbol Series", "Complex Series Patterns"],
            38: ["Word Analogies Synonyms", "Word Analogies Antonyms", "Word Analogies Worker-Tool", "Word Analogies Part-Whole", "Word Analogies Cause-Effect"],
            39: ["Number Analogies Simple", "Number Analogies Logic-based", "Mixed Analogies", "Complex Relationships", "Analogy Applications"],
            40: ["Word Classification Meaning", "Word Classification Odd-one-out", "Number Classification", "Letter Classification", "Mixed Classification"],
            41: ["Letter Coding Forward/Backward", "Number Coding Position-based", "Mixed Letter-Number Coding", "Symbol Coding", "Conditional Coding"],
            42: ["Matrix Coding", "Message Word Codes", "Coding by Analogy", "Binary Coding", "Clock-based Coding"],
            43: ["Simple Family Relations", "Coded Relations", "Family Tree Problems", "Complex Relations", "Multiple Family Problems"],
            44: ["Basic Direction Concepts", "Complex Direction Paths", "Direction with Distance", "Shadow-based Directions", "Direction Puzzles"],
            45: ["Rank from Left/Right", "Rank in Queue", "Height/Weight Ordering", "Age-based Ordering", "Multiple Parameter Ordering"],
            46: ["Single Row Arrangements", "Double Row Arrangements", "North-South Facing", "Complex Linear Sets", "Linear with Multiple Parameters"],
            47: ["Facing Centre", "Facing Outward", "Mixed Facing", "Circular with Gaps", "Complex Circular"],
            48: ["Square Arrangements", "Rectangular Facing", "Mixed Shape Arrangements", "Complex Seating", "Multi-table Arrangements"],
            49: ["Single Parameter Floors", "Double Parameter Floors", "Multiple Parameters", "Complex Floor Systems", "Building-based Puzzles"],
            50: ["Days of Week", "Months/Dates", "Time-based Scheduling", "Multiple Events", "Complex Scheduling"],
            51: ["2-Statement Syllogism", "3-Statement Syllogism", "Either-or Cases", "Coded Syllogism", "Complex Syllogism"],
            52: ["Statement-Conclusion Definite", "Statement-Conclusion Possibility", "Statement-Assumption Necessary", "Statement-Assumption Possible", "Statement-Argument Strong/Weak"],
            53: ["Cause & Effect", "Course of Action", "Inference Drawing", "Logical Consistency", "Paradox Resolution"],
            54: ["Group Formation", "Selection Problems", "Distribution Problems", "Comparison Puzzles", "Logical Sequence"],
            55: ["Condition-based Decisions", "Data-based Decisions", "Ethical Decision Making", "Administrative Decisions", "Complex Scenario Analysis"],
            56: ["Figure Series Completion", "Missing Figure Series", "Figure Analogy", "Figure Classification", "Pattern Completion"],
            57: ["Mirror Images Vertical", "Mirror Images Horizontal", "Water Images", "Paper Folding", "Paper Cutting"],
            58: ["Cube Faces Counting", "Cube Painting", "Dice Standard Problems", "Dice Unfolded Nets", "Cube Assembly"],
            59: ["Venn Diagrams 2-circle", "Venn Diagrams 3-circle", "Counting Figures Triangles", "Counting Figures Squares", "Counting Figures Rectangles"],
            60: ["Embedded Figures Simple", "Embedded Figures Complex", "Figure Completion", "Dot Situation", "Shape Rotation"],
            61: ["Nouns & Types", "Pronouns & Usage", "Verbs & Tenses", "Adjectives & Degrees", "Adverbs & Types"],
            62: ["Prepositions & Usage", "Conjunctions & Types", "Interjections", "Articles & Determiners", "Subject-Verb Agreement"],
            63: ["Present Tenses", "Past Tenses", "Future Tenses", "Perfect Tenses", "Continuous Tenses"],
            64: ["Active-Passive Voice", "Direct-Indirect Speech", "Question Tags", "Modals & Auxiliaries", "Conditionals"],
            65: ["Sentence Types", "Clause Analysis", "Phrase Usage", "Parallelism", "Sentence Variety"],
            66: ["Tense Errors", "Subject-Verb Errors", "Pronoun Errors", "Preposition Errors", "Article Errors"],
            67: ["Conjunction Errors", "Modifier Errors", "Parallelism Errors", "Redundancy Errors", "Ambiguity Errors"],
            68: ["Phrase Replacement", "Error Correction", "Sentence Rearrangement", "Para Jumbles", "Sentence Completion"],
            69: ["Synonyms", "Antonyms", "One Word Substitution", "Homophones/Homonyms", "Confusables"],
            70: ["Idioms & Phrases", "Phrasal Verbs", "Foreign Words", "Word Analogies", "Contextual Vocabulary"],
            71: ["Fact-based RC", "Inference-based RC", "Vocabulary-in-context", "Tone & Purpose", "Main Idea & Theme"],
            72: ["Complex Passage Analysis", "Critical Reading", "Comparative Reading", "Technical Passage", "Literary Passage"],
            73: ["Cloze Test", "Para Completion", "Sentence Connectors", "Word Usage", "Spelling & Punctuation"],
            74: ["Indus Valley Civilization", "Vedic Period", "Mahajanapadas", "Mauryan Empire", "Gupta Empire"],
            75: ["Delhi Sultanate", "Mughal Empire", "Bhakti Movement", "Sufi Movement", "Maratha Empire"],
            76: ["Advent of Europeans", "British East India Company", "Revolt of 1857", "Social Reform Movements", "Indian National Congress"],
            77: ["Gandhian Era", "Revolutionary Movements", "Constitutional Development", "Independence & Partition", "Governor Generals & Viceroys"],
            78: ["Architecture & Monuments", "Dance Forms", "Music Traditions", "Painting Styles", "Literature & Languages"],
            79: ["Earth & Universe", "Landforms & Rocks", "Climate & Weather", "Natural Vegetation", "Soil Types"],
            80: ["Physical Features India", "River Systems India", "Climate & Monsoon", "Natural Resources", "Agriculture Patterns"],
            81: ["Continents & Oceans", "Major Landforms", "Climate Zones", "Economic Geography", "Environmental Geography"],
            82: ["Ecosystem Types", "Biodiversity", "Conservation Efforts", "Environmental Pollution", "Climate Change"],
            83: ["Natural Disasters", "Man-made Disasters", "Disaster Preparedness", "Mitigation Strategies", "Government Initiatives"],
            84: ["Constitution Features", "Preamble", "Fundamental Rights", "Directive Principles", "Fundamental Duties"],
            85: ["Union Executive", "Parliament", "Judiciary", "State Government", "Local Government"],
            86: ["Election Process", "Political Parties", "Federal Structure", "Center-State Relations", "Important Laws"],
            87: ["Economic Concepts", "National Income", "Planning in India", "Economic Reforms", "Poverty & Unemployment"],
            88: ["Agriculture Sector", "Industry Sector", "Service Sector", "Banking System", "Public Finance"],
            89: ["Education System", "Health & Family Welfare", "Poverty Alleviation", "Rural Development", "Urban Development"],
            90: ["Microeconomics Concepts", "Macroeconomics Concepts", "Inflation & Deflation", "Monetary Policy", "International Trade"],
            91: ["Physics Fundamentals", "Chemistry Fundamentals", "Biology Fundamentals", "Scientific Laws", "Inventions & Discoveries"],
            92: ["Information Technology", "Communication Technology", "Space Technology", "Defense Technology", "Biotechnology"],
            93: ["Computer Basics", "Hardware Components", "Software Types", "Operating Systems", "Memory & Storage"],
            94: ["Computer Networks", "Internet & Web", "Database Management", "Programming Basics", "Cyber Security"],
            95: ["Banking History", "Types of Banks", "Banking Products", "Digital Banking", "RBI & its Functions"],
            96: ["Capital Markets", "Money Markets", "Stock Exchanges", "Mutual Funds", "Insurance Sector"],
            97: ["Financial Regulators", "Monetary Policy", "Fiscal Policy", "Economic Survey", "Union Budget"],
            98: ["International Organizations", "World Politics", "Indian Foreign Policy", "Bilateral Relations", "Global Issues"],
            99: ["National Awards", "International Awards", "Sports Tournaments", "Player Achievements", "Sports Governance"],
            100: ["Government Schemes", "Important Days", "Books & Authors", "Cultural Events", "Famous Personalities"]
        };

        // UI Logic
        function renderApp() {
            const mount = document.getElementById('plan-mount');
            if (!mount) return;
            mount.innerHTML = '';
            globalIDMap = [];
            let gid = 0;

            planData.forEach(phase => {
                const phaseDiv = document.createElement('div');
                phaseDiv.className = "phase-wrapper bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden mb-8";
                phaseDiv.id = phase.id;

                let html = `
                    <button onclick="toggleAccordion('body-${phase.id}', 'chevron-${phase.id}')" class="w-full text-left p-6 phase-btn phase-${phase.color} flex items-center justify-between focus:outline-none">
                        <div class="flex items-center gap-5">
                            <svg id="chevron-${phase.id}" class="chevron-icon w-6 h-6 opacity-60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M19 9l-7 7-7-7"></path></svg>
                            <div>
                                <h2 class="text-xl font-black leading-none uppercase tracking-tight">${phase.title}</h2>
                                <p class="text-[9px] font-black uppercase tracking-widest mt-1 opacity-60">${phase.range}</p>
                            </div>
                        </div>
                        <div id="badge-${phase.id}" class="bg-slate-100 text-slate-900 px-4 py-1.5 rounded-xl text-xs font-black min-w-[50px] text-center border border-slate-200">0%</div>
                    </button>
                    <div id="body-${phase.id}" class="accordion-content p-4 space-y-6">
                `;

                phase.sections.forEach(sec => {
                    const secCleanID = sec.name.replace(/\s/g, '');
                    const secID = `${phase.id}-${secCleanID}`;
                    html += `
                        <div class="section-container border border-slate-200 rounded-2xl overflow-hidden bg-white shadow-sm">
                            <button onclick="toggleAccordion('sec-body-${secID}', 'chevron-${secID}')" class="w-full flex items-center justify-between p-4 bg-slate-50 hover:bg-slate-100 transition-colors focus:outline-none">
                                <h3 class="text-sm font-black text-slate-800 flex items-center">
                                    <span class="w-1.5 h-4 bg-slate-400 rounded-full mr-3"></span>
                                    ${sec.name}
                                </h3>
                                <div class="flex items-center gap-3">
                                    <span id="milestone-${phase.id}-${secCleanID}" class="text-[8px] font-black uppercase text-slate-500 bg-white px-2 py-0.5 rounded-md shadow-sm border border-slate-200">Pending</span>
                                    <svg id="chevron-${secID}" class="chevron-icon w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                                </div>
                            </button>
                            <div id="sec-body-${secID}" class="accordion-content">
                                <table class="w-full text-left border-collapse">
                                    <tbody class="divide-y divide-slate-100">
                    `;

                    sec.weeks.forEach(weekNum => {
                        const weekID = `w-${phase.id}-${weekNum}`;
                        const weekTopics = topicsDb[weekNum] || topicsDb.default;
                        html += `
                            <tr id="week-row-${weekNum}" class="bg-slate-50/30">
                                <td colspan="3" class="py-3 px-6 border-b border-slate-100">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-4">
                                            <span class="text-[10px] font-black text-slate-600 uppercase tracking-widest bg-white px-2.5 py-1 rounded border border-slate-200">Week ${weekNum}</span>
                                            <div class="flex gap-1.5" id="week-dots-${weekNum}">
                                                ${Array.from({length: 5}).map(() => `<div class="w-2.5 h-2.5 rounded-full bg-slate-200"></div>`).join('')}
                                            </div>
                                        </div>
                                        <button onclick="toggleWeek('${weekID}', ${weekNum})" id="btn-${weekID}" class="text-[9px] font-black text-slate-600 bg-white px-3 py-1.5 rounded-lg border border-slate-200 hover:border-blue-500 transition-all">Mark Week</button>
                                    </div>
                                </td>
                            </tr>
                        `;
                        weekTopics.forEach((topic, tidx) => {
                            gid++;
                            globalIDMap.push({ id: gid, topic, week: weekNum, phaseTitle: phase.title, phaseID: phase.id, weekID: weekID, sectionID: `sec-body-${secID}`, secCleanID: secCleanID });
                            html += `
                                <tr class="topic-row hover:bg-slate-50 transition-all group" data-id="${gid}" data-topic="${topic.toLowerCase()}">
                                    <td class="py-4 px-6 w-12 text-[10px] font-bold text-slate-300">#${tidx+1}</td>
                                    <td class="py-4 px-3">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-4">
                                                <p onclick="openFocus(${gid})" class="text-slate-950 text-sm font-extrabold group-hover:text-blue-600 cursor-pointer leading-snug">${topic}</p>
                                                <svg onclick="toggleStar(${gid}, event)" id="star-${gid}" class="star-toggle w-4 h-4 hover:scale-125" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.518 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.921-.755 1.688-1.54 1.118l-3.976-2.888a1 1 0 00-1.175 0l-3.976 2.888c-.784.57-1.838-.197-1.539-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>
                                                <span id="date-label-${gid}" class="date-label"></span>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="py-4 px-6 text-center w-20">
                                        <input type="checkbox" data-id="${gid}" data-week-num="${weekNum}" data-phase="${phase.id}" data-section="${secCleanID}" data-week="${weekID}" class="task-checkbox" onchange="syncUI()">
                                    </td>
                                </tr>
                            `;
                        });
                    });

                    html += `</tbody></table></div></div>`;
                });

                html += `</div>`;
                phaseDiv.innerHTML = html;
                mount.appendChild(phaseDiv);
            });

            initDashboard();
        }

        function initDashboard() {
            const progress = JSON.parse(localStorage.getItem('coc_progress_v6') || '{}');
            const stars = JSON.parse(localStorage.getItem('coc_stars_v6') || '{}');
            const startDate = localStorage.getItem('coc_start_date');
            const dates = JSON.parse(localStorage.getItem('coc_dates_v6') || '{}');

            if (startDate) {
                const dateEl = document.getElementById('planStartDate');
                if(dateEl) dateEl.value = startDate;
            }

            document.querySelectorAll('.task-checkbox').forEach(cb => {
                const id = cb.dataset.id;
                if (progress[id]) {
                    cb.checked = true;
                    updateRowDate(id, dates[id]);
                }
            });

            Object.entries(stars).forEach(([id, active]) => {
                const starEl = document.getElementById(`star-${id}`);
                if (active && starEl) starEl.classList.add('active');
            });

            syncUI();
        }

        function syncUI() {
            const current = {};
            const dates = JSON.parse(localStorage.getItem('coc_dates_v6') || '{}');
            document.querySelectorAll('.task-checkbox').forEach(cb => {
                const id = cb.dataset.id;
                current[id] = cb.checked;
                if (cb.checked) {
                    if (!dates[id]) dates[id] = new Date().toISOString();
                    updateRowDate(id, dates[id]);
                } else {
                    delete dates[id];
                }
            });
            localStorage.setItem('coc_progress_v6', JSON.stringify(current));
            localStorage.setItem('coc_dates_v6', JSON.stringify(dates));
            updateProgress();
            updateStreak();
            generateHeatmap();
            checkAchievements();
            updateWeeklyDots();
        }

        function updateRowDate(id, dateStr) {
            const label = document.getElementById(`date-label-${id}`);
            if (label && dateStr) {
                const d = new Date(dateStr);
                label.innerText = `DONE ${d.toLocaleDateString('en-IN', {day:'2-digit', month:'short'})}`;
            }
        }

        function updateProgress() {
            const total = 500;
            const checkboxes = Array.from(document.querySelectorAll('.task-checkbox'));
            const checkedCount = checkboxes.filter(cb => cb.checked).length;
            const perc = Math.round((checkedCount / total) * 100);

            if (document.getElementById('percentText')) document.getElementById('percentText').innerText = perc + '%';
            if (document.getElementById('xpBar')) document.getElementById('xpBar').style.width = perc + '%';
            if (document.getElementById('xpText')) document.getElementById('xpText').innerText = `${checkedCount * 100} XP`;
            if (document.getElementById('masteryLevel')) document.getElementById('masteryLevel').innerText = Math.floor((checkedCount*100)/1000) + 1;

            const sidebarStats = document.getElementById('sidebarStats');
            if (sidebarStats) {
                sidebarStats.innerHTML = '';
                planData.forEach(p => {
                    const pChecked = Array.from(document.querySelectorAll(`.task-checkbox[data-phase="${p.id}"]:checked`)).length;
                    const pTotal = Array.from(document.querySelectorAll(`.task-checkbox[data-phase="${p.id}"]`)).length;
                    const pPerc = Math.round((pChecked/pTotal)*100) || 0;
                    const b = document.getElementById(`badge-${p.id}`);
                    if(b) b.innerText = pPerc + '%';
                    sidebarStats.innerHTML += `
                        <div class="mb-3">
                            <div class="flex justify-between text-[10px] font-black text-slate-700 uppercase mb-1 tracking-tight">
                                <span>${p.title.split(' ')[0]}</span>
                                <span>${pPerc}%</span>
                            </div>
                            <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden border border-slate-200 shadow-inner">
                                <div class="bg-blue-600 h-full transition-all duration-1000" style="width: ${pPerc}%"></div>
                            </div>
                        </div>
                    `;
                });
            }

            const startDateStr = localStorage.getItem('coc_start_date');
            const ntTitle = document.getElementById('nextTopicTitle');
            const ntMeta = document.getElementById('nextTopicMeta');
            const ntLabel = document.getElementById('targetTypeLabel');
            const targetCard = document.getElementById('smartTargetCard');
            
            let suggestedItem = null;
            let statusLabel = "TIMELINE TARGET";

            if (startDateStr) {
                const startDate = new Date(startDateStr);
                const diffDays = Math.floor((new Date() - startDate) / (1000 * 60 * 60 * 24));
                const currentWeek = Math.floor(diffDays / 7) + 1;
                const currentDayOfWeek = (diffDays % 7) + 1;
                if(document.getElementById('currentPlanWeek')) document.getElementById('currentPlanWeek').innerText = `Week ${currentWeek > 0 ? currentWeek : 1}`;

                if (currentDayOfWeek <= 5) {
                    const idxInWeek = currentDayOfWeek - 1;
                    suggestedItem = globalIDMap.find(item => item.week == currentWeek && globalIDMap.filter(x => x.week == currentWeek).indexOf(item) == idxInWeek);
                    const cbMatch = document.querySelector(`.task-checkbox[data-id="${suggestedItem?.id}"]`);
                    if (cbMatch && cbMatch.checked) {
                        const firstInc = globalIDMap.find(item => !document.querySelector(`.task-checkbox[data-id="${item.id}"]`).checked);
                        suggestedItem = firstInc;
                        statusLabel = "AHEAD OF PLAN";
                    } else {
                        statusLabel = "ASSIGNED FOR TODAY";
                    }
                }
            }

            if (!suggestedItem) {
                const firstPending = checkboxes.find(cb => !cb.checked);
                if (firstPending) {
                    suggestedItem = globalIDMap.find(t => t.id == firstPending.dataset.id);
                    statusLabel = "PENDING BACKLOG";
                }
            }

            if (suggestedItem && ntTitle) {
                ntTitle.innerText = suggestedItem.topic;
                ntMeta.innerText = `${suggestedItem.phaseTitle} • W${suggestedItem.week}`;
                ntTitle.dataset.id = suggestedItem.id;
                ntLabel.innerText = statusLabel;
                targetCard.style.borderColor = statusLabel === "PENDING BACKLOG" ? "#fbbf24" : "#3b82f6";
                ntLabel.style.color = statusLabel === "PENDING BACKLOG" ? "#d97706" : "#3b82f6";
            }
            updateMilestones();
        }

        function openNavigator() {
            const grid = document.getElementById('navigatorGrid');
            if(!grid) return;
            grid.innerHTML = '';
            const startDateStr = localStorage.getItem('coc_start_date');
            let currentWeekNum = 0;
            if (startDateStr) {
                const startDate = new Date(startDateStr);
                currentWeekNum = Math.floor(Math.floor((new Date() - startDate) / (1000 * 60 * 60 * 24)) / 7) + 1;
            }

            for (let w = 1; w <= 100; w++) {
                const checkboxes = Array.from(document.querySelectorAll(`.task-checkbox[data-week-num="${w}"]`));
                const checkedCount = checkboxes.filter(cb => cb.checked).length;
                let bgColor = "bg-slate-100 text-slate-400";
                if (checkedCount === 5) bgColor = "bg-green-500 text-white shadow-md shadow-green-200";
                else if (checkedCount > 0) bgColor = "bg-blue-500 text-white shadow-md shadow-blue-200";
                const isCurrent = (w === currentWeekNum);
                const btn = document.createElement('button');
                btn.className = `p-3 rounded-xl text-xs font-black transition-all ${bgColor} ${isCurrent ? 'current-week-pulse ring-2 ring-blue-600 ring-offset-2' : ''}`;
                btn.innerText = w;
                btn.onclick = () => { jumpToWeek(w); closeNavigator(); };
                grid.appendChild(btn);
            }
            document.getElementById('navigatorModal').classList.add('open');
        }

        function closeNavigator() { document.getElementById('navigatorModal').classList.remove('open'); }

        function jumpToWeek(num) {
            const item = globalIDMap.find(t => t.week == num);
            if (!item) return;
            const phaseBody = document.getElementById(`body-${item.phaseID}`);
            const secBody = document.getElementById(item.sectionID);
            const phaseChevron = document.getElementById(`chevron-${item.phaseID}`);
            const secChevron = document.getElementById(`chevron-${item.sectionID.replace('sec-body-', '')}`);
            if (phaseBody) { phaseBody.classList.add('open'); if(phaseChevron) phaseChevron.classList.add('rotated'); }
            if (secBody) { secBody.classList.add('open'); if(secChevron) secChevron.classList.add('rotated'); }
            setTimeout(() => {
                const row = document.getElementById(`week-row-${num}`);
                if (row) {
                    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    row.classList.add('bg-blue-100/50');
                    setTimeout(() => row.classList.remove('bg-blue-100/50'), 2500);
                }
            }, 300);
        }

        function toggleAccordion(id, icon) {
            document.getElementById(id).classList.toggle('open');
            document.getElementById(icon).classList.toggle('rotated');
        }
        function setTheme(t) { document.body.className = `theme-${t}`; localStorage.setItem('coc_theme', t); }
        function setStartDate(val) { localStorage.setItem('coc_start_date', val); syncUI(); }
        function celebrate() { confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } }); }
        function confirmReset() { if(confirm("Wipe all history?")) { localStorage.clear(); location.reload(); } }

        function generateHeatmap() {
            const cont = document.getElementById('heatmap');
            if (!cont) return;
            cont.innerHTML = '';
            const dates = JSON.parse(localStorage.getItem('coc_dates_v6') || '{}');
            const activityByDate = {};
            Object.values(dates).forEach(d => activityByDate[new Date(d).toDateString()] = (activityByDate[new Date(d).toDateString()] || 0) + 1);
            for(let i=13; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const count = activityByDate[d.toDateString()] || 0;
                const sq = document.createElement('div');
                sq.className = `heatmap-square ${count > 2 ? 'active-3' : count > 1 ? 'active-2' : count > 0 ? 'active-1' : ''}`;
                cont.appendChild(sq);
            }
        }

        function updateStreak() {
            const last = localStorage.getItem('coc_last_activity');
            const today = new Date().toDateString();
            let streak = parseInt(localStorage.getItem('coc_streak') || '0');
            if (last === today) return;
            const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
            if (last === yesterday.toDateString()) streak++; else streak = 1;
            localStorage.setItem('coc_streak', streak);
            localStorage.setItem('coc_last_activity', today);
            if(document.getElementById('streakVal')) document.getElementById('streakVal').innerText = streak;
        }

        function checkAchievements() {
            const checked = document.querySelectorAll('.task-checkbox:checked').length;
            const streak = parseInt(localStorage.getItem('coc_streak') || '0');
            const ids = [1, 10, 50, 100, 500];
            ids.forEach(id => {
                const el = document.getElementById(`ach-${id}`);
                if(el && checked >= id) el.classList.add('unlocked');
            });
        }

        function openFocus(id) {
            const topic = globalIDMap.find(t => t.id == id);
            const notes = JSON.parse(localStorage.getItem('coc_notes_v5') || '{}');
            document.getElementById('focusTitle').innerText = topic.topic;
            document.getElementById('focusPhase').innerText = `${topic.phaseTitle} • W${topic.week}`;
            document.getElementById('focusNote').value = notes[id] || "";
            document.getElementById('focusID').innerText = id;
            document.getElementById('focusModal').classList.add('open');
        }
        function closeFocus() {
            const id = document.getElementById('focusID').innerText;
            const note = document.getElementById('focusNote').value;
            const notes = JSON.parse(localStorage.getItem('coc_notes_v5') || '{}');
            notes[id] = note;
            localStorage.setItem('coc_notes_v5', JSON.stringify(notes));
            document.getElementById('focusModal').classList.remove('open');
            syncUI();
        }
        function markDoneInFocus() {
            const id = document.getElementById('focusID').innerText;
            const cb = document.querySelector(`.task-checkbox[data-id="${id}"]`);
            if(cb) cb.checked = true;
            closeFocus(); celebrate();
        }

        function toggleStar(id, e) {
            e.stopPropagation();
            const stars = JSON.parse(localStorage.getItem('coc_stars_v6') || '{}');
            stars[id] = !stars[id];
            localStorage.setItem('coc_stars_v6', JSON.stringify(stars));
            document.getElementById(`star-${id}`).classList.toggle('active');
            applyFilters();
        }

        function toggleWeek(weekID, weekNum) {
            const checkboxes = document.querySelectorAll(`.task-checkbox[data-week="${weekID}"]`);
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            checkboxes.forEach(cb => cb.checked = !allChecked);
            syncUI();
            if (!allChecked) celebrate();
        }

        function scrollToNext() {
            const id = document.getElementById('nextTopicTitle').dataset.id;
            if (id) jumpToWeek(globalIDMap.find(t => t.id == id).week);
        }

        function filterMode() {
            isRevisionMode = !isRevisionMode;
            const btn = document.getElementById('starFilterBtn');
            if (btn) {
                btn.classList.toggle('bg-amber-400', isRevisionMode);
                btn.classList.toggle('text-white', isRevisionMode);
            }
            applyFilters();
        }

        function applyFilters() {
            const searchInput = document.getElementById('topicSearch');
            const q = searchInput ? searchInput.value.toLowerCase() : "";
            const stars = JSON.parse(localStorage.getItem('coc_stars_v6') || '{}');
            document.querySelectorAll('.topic-row').forEach(row => {
                const matchesSearch = row.getAttribute('data-topic').includes(q);
                const matchesRevision = !isRevisionMode || stars[row.dataset.id];
                row.style.display = (matchesSearch && matchesRevision) ? 'table-row' : 'none';
            });
        }

        function updateMilestones() {
            planData.forEach(phase => {
                phase.sections.forEach(sec => {
                    const secCleanID = sec.name.replace(/\s/g, '');
                    const checkboxes = Array.from(document.querySelectorAll(`.task-checkbox[data-section="${secCleanID}"]`));
                    const done = checkboxes.filter(c => c.checked).length;
                    const label = document.getElementById(`milestone-${phase.id}-${secCleanID}`);
                    if(label) {
                        label.innerText = (done === checkboxes.length && done > 0) ? "Mastered" : (done > 0 ? `${Math.round((done/checkboxes.length)*100)}%` : "Pending");
                        label.className = `text-[9px] font-black uppercase tracking-widest px-2 py-0.5 rounded-md border ${done === checkboxes.length ? 'bg-green-100 text-green-700' : 'bg-white text-slate-500'}`;
                    }
                });
            });
        }

        function updateWeeklyDots() {
            const dotsConts = document.querySelectorAll('[id^="week-dots-"]');
            dotsConts.forEach(cont => {
                const weekNum = cont.id.replace('week-dots-', '');
                const checkboxes = Array.from(document.querySelectorAll(`.task-checkbox[data-week-num="${weekNum}"]`));
                if (checkboxes.length === 0) return;
                const checkedCount = checkboxes.filter(cb => cb.checked).length;
                const cbFirst = checkboxes[0];
                const btn = document.getElementById(`btn-${cbFirst.dataset.week}`);
                if (btn) btn.innerText = (checkedCount === 5) ? "Reset" : "Mark Week";
                cont.innerHTML = checkboxes.map(cb => `<div class="w-2.5 h-2.5 rounded-full border ${cb.checked ? 'bg-blue-600 border-blue-700' : 'bg-slate-100 border-slate-200'}"></div>`).join('');
            });
        }

        function exportProgress() {
            const data = { v6_progress: localStorage.getItem('coc_progress_v6'), v6_dates: localStorage.getItem('coc_dates_v6'), stars: localStorage.getItem('coc_stars_v6'), notes: localStorage.getItem('coc_notes_v5'), streak: localStorage.getItem('coc_streak'), start: localStorage.getItem('coc_start_date') };
            const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], { type: 'application/json' })); a.download = "Timeline_Backup.json"; a.click();
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderApp();
            document.getElementById('topicSearch').addEventListener('input', applyFilters);
        });
    </script>
</body>
</html>
